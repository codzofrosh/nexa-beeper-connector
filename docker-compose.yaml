version: "3.9"

services:
  nexa-sidecar:
    image: nexa-sidecar:v1.0.0
    container_name: nexa-sidecar
    restart: unless-stopped

    environment:
      # Core
      ENABLE_EXECUTOR: "0"
      LOG_LEVEL: "INFO"

      # DB
      SQLITE_PATH: /data/nexa.db

    ports:
      - "8080:8080"

    volumes:
      - nexa_data:/data

    command: >
      uvicorn sidecar.main:app
      --host 0.0.0.0
      --port 8080
      --workers 1
  mautrix-whatsapp:
    image: dock.mau.dev/mautrix/whatsapp:latest
    container_name: nexa-whatsapp-bridge
    volumes:
      - ./bridge/whatsapp/config.yaml:/data/config.yaml
      - ./data/whatsapp:/data
    networks:
      - nexa-network
    depends_on:
      - nexa-sidecar  # Your existing service
    restart: unless-stopped
    environment:
      - WEBHOOK_URL=http://nexa-sidecar:8000/api/messages/incoming
volumes:
  nexa_data:
networks:
  nexa-network:  
    driver: bridge